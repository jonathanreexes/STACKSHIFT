<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>STACKSHIFT</title>
  <link rel="icon" type="image/png" href="favicon.png">
  <style>
    :root{--bg:#0b0f1a;--panel:#121a2b;--accent:#7cf8ff;--accent2:#ff71e6;--good:#7dff8a;--warn:#ffd36e;--text:#e6f1ff;--ghost:#2a3a5e}
    *{box-sizing:border-box}
    html,body{height:100%;margin:0;background:radial-gradient(1200px 800px at 70% -10%, #152143 0%, var(--bg) 60%, #070a12 100%);color:var(--text);font-family:Inter,system-ui,Segoe UI,Roboto,Helvetica,Arial,sans-serif}
    .wrap{display:grid;grid-template-columns:1fr auto 1fr;gap:18px;max-width:1100px;margin:24px auto;padding:16px}
    .card{background:linear-gradient(180deg, rgba(255,255,255,.05), rgba(255,255,255,.02));border:1px solid rgba(255,255,255,.08);border-radius:16px;backdrop-filter:blur(6px);box-shadow:0 10px 30px rgba(0,0,0,.35)}
    h1{grid-column:1/-1;text-align:center;font-weight:800;letter-spacing:.5px;margin:6px 0 2px;font-size:28px;display:flex;align-items:center;justify-content:center;gap:10px}
    h1 img{height:32px}
    .subtitle{grid-column:1/-1;text-align:center;margin-bottom:6px;opacity:.8}
    .game{display:grid;grid-template-columns:auto;justify-content:center;align-items:center;padding:12px}
    canvas{display:block;border-radius:10px;background:linear-gradient(180deg,#0c1120,#0a0f1b)}
    .side{display:flex;flex-direction:column;gap:14px}
    .box{padding:12px}
    .grid{display:grid;grid-template-columns:repeat(2,1fr);gap:10px}
    .stat{background:var(--panel);border:1px solid rgba(255,255,255,.08);border-radius:12px;padding:10px}
    .stat h3{margin:0 0 6px;font-size:12px;opacity:.8;font-weight:600}
    .stat .val{font-size:20px;font-weight:700}
    .pillbar{display:flex;gap:8px;flex-wrap:wrap}
    .pill{border:1px solid rgba(255,255,255,.10);background:rgba(255,255,255,.03);padding:6px 10px;border-radius:999px;font-size:12px}
    .controls{display:grid;grid-template-columns:repeat(3,1fr);gap:8px;margin-top:8px}
    .btn{cursor:pointer;text-align:center;padding:10px;border-radius:12px;border:1px solid rgba(255,255,255,.15);background:linear-gradient(180deg, rgba(255,255,255,.06), rgba(255,255,255,.02));user-select:none}
    .btn:hover{border-color:var(--accent)}
    .big{grid-column:1/-1;padding:12px;font-weight:700}
    .flex{display:flex;align-items:center;gap:10px;justify-content:space-between}
    .next,.hold{display:flex;gap:8px;align-items:center}
    .mini{width:70px;height:70px;background:var(--panel);border:1px solid rgba(255,255,255,.08);border-radius:12px}
    .credit{text-align:center;margin:10px 0;opacity:.65;font-size:12px}
    .mobile{position:fixed;left:0;right:0;bottom:12px;display:none;gap:8px;justify-content:center;z-index:10}
    .mobile .mkey{width:64px;height:64px;border-radius:14px;border:1px solid rgba(255,255,255,.18);background:linear-gradient(180deg, rgba(255,255,255,.06), rgba(255,255,255,.02));display:flex;align-items:center;justify-content:center;font-weight:700}
    @media (max-width:980px){.wrap{grid-template-columns:1fr;gap:12px}.mobile{display:flex}}
    .glow{position:relative}.glow::after{content:"";position:absolute;inset:-8px;z-index:-1;border-radius:16px;filter:blur(18px);background:conic-gradient(from 180deg at 50% 50%, var(--accent), var(--accent2), var(--good), var(--accent));opacity:.35}
  </style>
</head>
<body>
  <div class="wrap">
    <h1><img src="favicon.png" alt="STACKSHIFT logo">STACKSHIFT</h1>
    <div class="subtitle">Hard drop ‚Ä¢ Hold piece ‚Ä¢ Next queue ‚Ä¢ Ghost ‚Ä¢ Mobile controls ‚Ä¢ Sound</div>

    <div class="side">
      <div class="card box">
        <div class="flex hold">
          <div>
            <div class="pill">Hold (C)</div>
            <div class="pillbar" id="holdName"></div>
          </div>
          <canvas id="hold" class="mini" width="70" height="70"></canvas>
        </div>
      </div>

      <div class="card box">
        <div class="grid">
          <div class="stat"><h3>Score</h3><div class="val" id="score">0</div></div>
          <div class="stat"><h3>Level</h3><div class="val" id="level">1</div></div>
          <div class="stat"><h3>Lines</h3><div class="val" id="lines">0</div></div>
          <div class="stat"><h3>Speed</h3><div class="val" id="speed">1.0x</div></div>
        </div>
      </div>

      <div class="card box">
        <div class="pillbar">
          <div class="pill">Move: ‚Üê ‚Üí</div><div class="pill">Soft: ‚Üì</div><div class="pill">Rotate: ‚Üë / Z / X</div>
          <div class="pill">Hard: Space</div><div class="pill">Hold: C</div><div class="pill">Pause: P</div><div class="pill">Restart: R</div>
        </div>
      </div>
    </div>

    <div class="card game glow">
      <canvas id="board" width="300" height="600"></canvas>
    </div>

    <div class="side">
      <div class="card box">
        <div class="flex next">
          <div><div class="pill">Next</div><div class="pillbar" id="nextNames"></div></div>
        </div>
        <div class="flex" style="margin-top:8px; gap:10px; flex-wrap:wrap">
          <canvas id="n1" class="mini" width="70" height="70"></canvas>
          <canvas id="n2" class="mini" width="70" height="70"></canvas>
          <canvas id="n3" class="mini" width="70" height="70"></canvas>
        </div>
      </div>

      <div class="card box">
        <div class="controls">
          <div class="btn" id="btn-left">‚Üê</div>
          <div class="btn" id="btn-down">‚Üì</div>
          <div class="btn" id="btn-right">‚Üí</div>
          <div class="btn big" id="btn-rotate">Rotate</div>
          <div class="btn big" id="btn-hard">HARD DROP</div>
          <div class="btn big" id="btn-hold">HOLD</div>
          <div class="btn" id="btn-pause">‚èØ</div>
          <div class="btn" id="btn-restart">‚ü≤</div>
          <div class="btn" id="btn-sound">üîä</div>
        </div>
      </div>

      <div class="credit card box">STACKSHIFT ‚Äî HTML5 Canvas + JS</div>
    </div>
  </div>

  <div class="mobile">
    <div class="mkey" id="m-left">‚Üê</div>
    <div class="mkey" id="m-rotate">‚ü≥</div>
    <div class="mkey" id="m-hard">‚¨áÔ∏é</div>
    <div class="mkey" id="m-right">‚Üí</div>
  </div>

<script>
(()=>{const COLS=10,ROWS=20,CELL=30,START_DROP_MS=800,SPEEDUP_EVERY=10,SPEED_FACTOR=0.88,LOCK_DELAY_MS=480;
const canvas=document.getElementById("board"),ctx=canvas.getContext("2d"),holdCtx=document.getElementById("hold").getContext("2d"),n1=document.getElementById("n1").getContext("2d"),n2=document.getElementById("n2").getContext("2d"),n3=document.getElementById("n3").getContext("2d");
const scoreEl=document.getElementById("score"),levelEl=document.getElementById("level"),linesEl=document.getElementById("lines"),speedEl=document.getElementById("speed"),holdNameEl=document.getElementById("holdName"),nextNamesEl=document.getElementById("nextNames");
const bind=(id,fn)=>document.getElementById(id)?.addEventListener("click",fn);
bind("btn-left",()=>move(-1));bind("btn-right",()=>move(1));bind("btn-down",()=>softDrop());bind("btn-rotate",()=>rotate(1));bind("btn-hard",()=>hardDrop());bind("btn-hold",()=>hold());bind("btn-pause",()=>togglePause());bind("btn-restart",()=>restart());bind("btn-sound",()=>toggleSound());
document.getElementById("m-left").onclick=()=>move(-1);document.getElementById("m-right").onclick=()=>move(1);document.getElementById("m-rotate").onclick=()=>rotate(1);document.getElementById("m-hard").onclick=()=>hardDrop();

let soundOn=true;function tone(f=440,d=0.05,t="sine",v=0.05){if(!soundOn)return;const a=new (window.AudioContext||window.webkitAudioContext)(),o=a.createOscillator(),g=a.createGain();o.connect(g);g.connect(a.destination);o.type=t;o.frequency.value=f;g.gain.value=v;o.start();setTimeout(()=>{o.stop();a.close()},d*1000)}const sDrop=()=>tone(560,0.02,"sawtooth",0.06),sLock=()=>tone(320,0.04,"square",0.06),sLine=()=>tone(720,0.08,"triangle",0.07),sRotate=()=>tone(640,0.03,"square",0.05),sHold=()=>tone(280,0.05,"sine",0.06);function toggleSound(){soundOn=!soundOn;alert("Sound: "+(soundOn?"ON":"OFF"))}

const SHAPES={I:{c:"#7cf8ff",m:[[0,0,0,0],[1,1,1,1],[0,0,0,0],[0,0,0,0]]},O:{c:"#ffd36e",m:[[1,1],[1,1]]},T:{c:"#ff71e6",m:[[1,1,1],[0,1,0],[0,0,0]]},S:{c:"#7dff8a",m:[[0,1,1],[1,1,0],[0,0,0]]},Z:{c:"#ff8a7d",m:[[1,1,0],[0,1,1],[0,0,0]]},J:{c:"#8fb1ff",m:[[1,0,0],[1,1,1],[0,0,0]]},L:{c:"#ffa96e",m:[[0,0,1],[1,1,1],[0,0,0]]}},BAG=Object.keys(SHAPES);

let grid,curr,pos,queue,holdPiece=null,canHold=true,score=0,level=1,lines=0,dropMs=START_DROP_MS,paused=false,over=false,lastFall=0,lockTimer=null;
const newGrid=()=>Array.from({length:ROWS},()=>Array(COLS).fill(null));
const squareWrap=m=>{const N=Math.max(m.length,m[0].length),r=Array.from({length:N},()=>Array(N).fill(0));for(let y=0;y<m.length;y++)for(let x=0;x<m[0].length;x++)r[y][x]=m[y][x];return r};
const rotateMatrix=(m,d=1)=>{const N=m.length,r=Array.from({length:N},()=>Array(N).fill(0));for(let y=0;y<N;y++)for(let x=0;x<N;x++)r[d>0?x:N-1-x][d>0?N-1-y:y]=m[y][x];return r};
const topPad=m=>{for(let y=0;y<m.length;y++)if(m[y].some(v=>v))return y;return 0};

function refillBag(){const bag=BAG.slice();for(let i=bag.length-1;i>0;i--){const j=Math.floor(Math.random()*(i+1));[bag[i],bag[j]]=[bag[j],bag[i]]}queue.push(...bag)}
function collide(g,m,p){for(let y=0;y<m.length;y++)for(let x=0;x<m.length;x++){if(!m[y][x])continue;const nx=p.x+x,ny=p.y+y;if(ny>=ROWS||nx<0||nx>=COLS)return true;if(ny>=0&&g[ny][nx])return true}return false}

function spawn(){if(queue.length<5)refillBag();const id=queue.shift(),s=SHAPES[id],m=squareWrap(s.m);curr={id,color:s.c,m};pos={x:Math.floor(COLS/2)-Math.ceil(m.length/2),y:-topPad(m)};canHold=true;if(collide(grid,curr.m,pos)){gameOver();return}drawSide()}
function merge(){for(let y=0;y<curr.m.length;y++)for(let x=0;x<curr.m.length;x++)if(curr.m[y][x]&&pos.y+y>=0)grid[pos.y+y][pos.x+x]=curr.color}
function clearLines(){let c=0;for(let y=ROWS-1;y>=0;y--){if(grid[y].every(v=>v)){grid.splice(y,1);grid.unshift(Array(COLS).fill(null));c++;y++}}if(c){const pts=[0,40,100,300,1200][c]*level;score+=pts;lines+=c;sLine();const nl=1+Math.floor(lines/SPEEDUP_EVERY);if(nl>level){level=nl;dropMs=Math.max(60,Math.floor(dropMs*SPEED_FACTOR))}updateHUD()}}
function stepDown(){const np={x:pos.x,y:pos.y+1};if(!collide(grid,curr.m,np)){pos=np;resetLock();return true}if(!lockTimer){lockTimer=setTimeout(lockPiece,LOCK_DELAY_MS)}return false}
function resetLock(){if(lockTimer){clearTimeout(lockTimer);lockTimer=null}}
function lockPiece(){resetLock();merge();clearLines();spawn()}

function softDrop(){if(over||paused)return;if(!stepDown())return;sDrop()}
function hardDrop(){if(over||paused)return;while(stepDown())score+=2;sLock();lockPiece()}
function move(d){if(over||paused)return;const np={x:pos.x+d,y:pos.y};if(!collide(grid,curr.m,np))pos=np}
function rotate(d){if(over||paused)return;const rm=rotateMatrix(curr.m,d),k=[0,-1,1,-2,2];for(const dx of k){const np={x:pos.x+dx,y:pos.y};if(!collide(grid,rm,np)){curr.m=rm;pos=np;sRotate();resetLock();return}}}
function hold(){if(over||paused||!canHold)return;const t=holdPiece;holdPiece=curr.id;canHold=false;sHold();if(t==null){spawn()}else{const sh=SHAPES[t];curr={id:t,color:sh.c,m:squareWrap(sh.m)};pos={x:Math.floor(COLS/2)-Math.ceil(curr.m.length/2),y:-topPad(curr.m)};if(collide(grid,curr.m,pos))gameOver()}drawSide()}
function togglePause(){if(over)return;paused=!paused;draw()}
function restart(){grid=newGrid();queue=[];refillBag();refillBag();holdPiece=null;canHold=true;score=0;lines=0;level=1;dropMs=START_DROP_MS;over=false;paused=false;spawn();updateHUD();draw()}
function gameOver(){over=true;paused=false;draw();setTimeout(()=>alert("Game Over! Score: "+score),50)}

function clearBoard(){ctx.clearRect(0,0,canvas.width,canvas.height);for(let y=0;y<ROWS;y++)for(let x=0;x<COLS;x++){ctx.fillStyle="rgba(255,255,255,0.02)";ctx.fillRect(x*CELL,y*CELL,CELL-1,CELL-1)}}
function drawBlock(cx,cy,color,ghost=false){const x=cx*CELL,y=cy*CELL;ctx.fillStyle=ghost?"#2a3a5e":color;ctx.fillRect(x+1,y+1,CELL-2,CELL-2);if(!ghost){const g=ctx.createLinearGradient(x,y,x,y+CELL);g.addColorStop(0,"rgba(255,255,255,.25)");g.addColorStop(0.4,"rgba(255,255,255,.08)");g.addColorStop(1,"rgba(0,0,0,.15)");ctx.fillStyle=g;ctx.fillRect(x+1,y+1,CELL-2,Math.max(2,CELL*0.35));ctx.strokeStyle="rgba(255,255,255,.12)";ctx.strokeRect(x+.5,y+.5,CELL-1,CELL-1)}}
function ghostPos(){let py=pos.y;while(!collide(grid,curr.m,{x:pos.x,y:py+1}))py++;return py}
function draw(){clearBoard();const gy=ghostPos();for(let y=0;y<curr.m.length;y++)for(let x=0;x<curr.m.length;x++)if(curr.m[y][x]){const gx=pos.x+x,gyy=gy+y;if(gyy>=0)drawBlock(gx,gyy,"#2a3a5e",true)}for(let y=0;y<ROWS;y++)for(let x=0;x<COLS;x++)if(grid[y][x])drawBlock(x,y,grid[y][x],false);for(let y=0;y<curr.m.length;y++)for(let x=0;x<curr.m.length;x++)if(curr.m[y][x]){const bx=pos.x+x,by=pos.y+y;if(by>=0)drawBlock(bx,by,curr.color,false)}if(paused||over){ctx.save();ctx.fillStyle="rgba(0,0,0,.45)";ctx.fillRect(0,0,canvas.width,canvas.height);ctx.fillStyle="#e6f1ff";ctx.font="bold 28px system-ui, sans-serif";ctx.textAlign="center";ctx.fillText(over?"GAME OVER":"PAUSED",canvas.width/2,canvas.height/2);ctx.restore()}}
function mini(ctx,id){ctx.clearRect(0,0,70,70);if(!id)return;const {m,c}=SHAPES[id],s=squareWrap(m),cell=14,size=s.length*cell,ox=(70-size)/2,oy=(70-size)/2;for(let y=0;y<s.length;y++)for(let x=0;x<s.length;x++)if(s[y][x]){ctx.fillStyle=c;ctx.fillRect(ox+x*cell+1,oy+y*cell+1,cell-2,cell-2)}}
function drawSide(){holdNameEl.innerHTML=holdPiece?`<span class="pill">${holdPiece}</span>`:"";nextNamesEl.innerHTML="";const n=queue.slice(0,3);n.forEach(k=>{const d=document.createElement("div");d.className="pill";d.textContent=k;nextNamesEl.appendChild(d)});mini(holdCtx,holdPiece);mini(n1,n[0]);mini(n2,n[1]);mini(n3,n[2])}
function updateHUD(){scoreEl.textContent=score;levelEl.textContent=level;linesEl.textContent=lines;speedEl.textContent=(START_DROP_MS/dropMs).toFixed(1)+"x"}
function loop(ts){if(!paused&&!over){if(ts-lastFall>dropMs){stepDown();lastFall=ts}draw()}requestAnimationFrame(loop)}
window.addEventListener("keydown",e=>{const k=e.key.toLowerCase();if(["arrowleft","arrowright","arrowdown"," "].includes(e.key))e.preventDefault();if(k==="arrowleft")move(-1);else if(k==="arrowright")move(1);else if(k==="arrowdown")softDrop();else if(k==="arrowup"||k==="x")rotate(1);else if(k==="z")rotate(-1);else if(e.key===" ")hardDrop();else if(k==="c")hold();else if(k==="p")togglePause();else if(k==="r")restart()});
restart();requestAnimationFrame(loop)})();
</script>
</body>
</html>
